<script type="text/javascript">
  RED.nodes.registerType("confidence", {
    category: "SHEN",
    color: "#74b9ff",
    defaults: {
      name: { value: "" },
      measurementUncertainty: { value: 0 },
    },
    inputs: 1,
    outputs: 2,
    inputLabels: "value",
    outputLabels: ["valueWithConfidence", "error"],
    icon: "status.png",
    label: function () {
      return this.name || "confidence";
    },
  });
</script>

<script type="text/html" data-template-name="confidence">
  <div class="form-row">
    <br />
    <label for="node-input-name">
      <i class="fa fa-tag"></i>
      <span data-i18n="node-red:common.label.name"></span>
    </label>
    <input
      type="text"
      id="node-input-name"
      data-i18n="[placeholder]node-red:common.label.name"
    />
  </div>
  <div class="form-row">
    <label for="node-input-measurementUncertainty" style="width:80%;">
      <i class="icon-tag"></i> Sensor's absolute measurement uncertainty (&#177 a positive value):
    </label>
    <input
      type="number"
      id="node-input-measurementUncertainty"
      placeholder="0"
      min="0"
      step="0.01"
    />
  </div>
</script>

<script type="text/html" data-help-name="confidence">
  <p>A node that tags a sensor reading with a confidence level.</p>
  <h3>Details</h3>
  <p>
    This node can be placed right after an "mqtt in" node subscribed to a topic
    for a given sensor's readings. The node receives an absolute measurement
    uncertainty, normally issued by the sensor's manufacturer, as an initial
    parameter. This uncertainty, in conjunction with the current reading value,
    is used to calculate the relative measurement uncertainty. This value is
    then subtracted to 100% to calculate the confidence level. Note that this
    node is not very useful with sensors that produce readings close to 0, since
    the relative measurement goes to infinity as the values tend to null.
  </p>
  <h3>Properties</h3>
  <dl class="message-properties">
    <dt>name<span class="property-type">string</span></dt>
    <dd>name of node to be displayed in editor</dd>

    <dt>measurement uncertainty<span class="property-type">integer</span></dt>
    <dd>
      the sensor's absolute measurement uncertainty, in the same unit as the
      sensor readings
    </dd>
  </dl>
  <h3>Inputs</h3>
  <dl class="message-properties">
    <p>Any input in which the payload is a number</p>
  </dl>
  <h3>Outputs</h3>
  <dl class="message-properties">
    <p>
      Equal to the last message object sent as input but with an additional
      <b>confidence</b> field, containing the calculated confidence level, in
      percentage
    </p>
  </dl>
</script>
