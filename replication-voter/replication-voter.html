<script type="text/javascript">
  RED.nodes.registerType("replication-voter", {
    category: "SHEN",
    defaults: {
      name: {
        value: "",
      },
      majority: {
        value: "2",
        required: true,
      },
      countInputs: {
        value: "2",
        required: false,
      },
    },
    icon: "status.png",
    color: "#74b9ff",
    inputs: 1,
    outputs: 2,
    align: "left",
    inputLabels: "JSONArray",
    outputLabels: ["majority", "no-majority(fault)"],
    label: function () {
      return this.name || "Replication Voter";
    },
  });
</script>

<script type="text/html" data-template-name="replication-voter">
  <div class="form-row">
    <label for="node-input-name"
      ><i class="fa fa-tag"></i>
      <span data-i18n="node-red:common.label.name"></span
    ></label>
    <input
      type="text"
      id="node-input-name"
      data-i18n="[placeholder]node-red:common.label.name"
    />
  </div>
  <div class="form-row">
    <label for="node-input-majority"
      ><i class="fa fa-tag"></i> Majority Value</label
    >
    <input type="number" id="node-input-majority" placeholder="2" />
  </div>
  <div class="form-row">
    <label for="node-input-countInputs"
      ><i class="fa fa-tag"></i> Number of Expected Inputs (if input is array
      value is ignored)</label
    >
    <input type="number" id="node-input-countInputs" placeholder="3" />
  </div>
</script>

<script type="text/html" data-help-name="replication-voter">
  <p>A node to check what is the majority value.</p>
  <h3>Properties</h3>
  <dl class="message-properties">
    <dt>
      name
      <span class="property-type">string</span>
    </dt>
    <dd>name of node to be displayed in editor</dd>
    <dt>majority value<span class="property-type">number</span></dt>
    <dd>number of equal values required to have a majority</dd>
    <dt>number of expected inputs<span class="property-type">number</span></dt>
    <dd>total number of inputs where the majority will be checked</dd>
  </dl>
  <h3>Inputs</h3>
  <dl class="message-properties">
    <dt>
      payload
      <span class="property-type">number | array&ltnumber&gt</span>
    </dt>
    <dd>number or array</dd>
  </dl>
  <h3>Outputs</h3>
  <dl class="message-properties">
    <dt>
      pauload
      <span class="property-type">number</span>
    </dt>
    <dd>if there is a majority, then the output is the majority value</dd>
    <dd>if not, the output is equal to the first input</dd>
  </dl>
  <h3>Details</h3>
  <p>
    If the input is a number, the node will check the majority every time it
    receives the number of expected inputs. If there is a number that is
    received equal or more times than the majority value, then this number is
    the majority. If not, there is no majority.
  </p>
  <p>
    If the input is an array, the node will check if there is a number on the
    array that is duplicated equal or more times than the majority value. If so,
    this number is the majority, and if not, there is no majority.
  </p>
  <p>
    If there are two or more numbers that appear equal or more times than the
    majority value, the majority will be the number that appears more times.
  </p>
</script>
